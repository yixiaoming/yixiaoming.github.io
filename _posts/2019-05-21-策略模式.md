---
title: ç­–ç•¥æ¨¡å¼
key: 20190521-design_patterns-strategy
author: Miles.y
tags:
  - è®¾è®¡æ¨¡å¼
categories:
  - design_patterns
comment: true
typora-copy-images-to: ../images/ç­–ç•¥æ¨¡å¼
---

## ä»‹ç»

> ç­–ç•¥æ¨¡å¼å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†å…·ä½“çš„ç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿ä¸Šå±‚ä½¿ç”¨è€…å¯éšæ„æ›¿æ¢ã€‚

ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ˜¯å°†å…·ä½“æ“ä½œé¦–å…ˆé€šè¿‡æ¥å£æŠ½è±¡ï¼Œç„¶åä¸Šå±‚ä½¿ç”¨è€…ä¾èµ–æ¥å£ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡ä¾èµ–å…·ä½“çš„å®ç°æ¥åšåˆ°ä½¿ç”¨è€…ä¸æ“ä½œè§£è€¦ï¼Œå¦‚æœæœ‰å¾ˆå¤šå¹³çº§çš„æ“ä½œä¹Ÿä¸éœ€è¦å†™åˆ¤æ–­ç›´æ¥ä¾èµ–å…·ä½“çš„ç­–ç•¥å³å¯ã€‚è¾¾åˆ°è§£è€¦å’Œæ‰©å±•çš„ä½œç”¨ã€‚

## åŸå‹å›¾

![image-20190521163251063](/images/ç­–ç•¥æ¨¡å¼/image-20190521163251063.png)

<!-- more -->

## ä»£ç ç¤ºä¾‹

è¿™é‡Œæˆ‘ä»¬ä»¥Androidä¸­RecyclerViewæ”¯æŒçº¿æ€§ï¼Œç½‘æ ¼ï¼Œç€‘å¸ƒæµä¸‰ç§å¸ƒå±€æ¥åšä¾‹å­è®²è§£ï¼ˆå½“ç„¶è¿™é‡Œå¹¶ä¸æ˜¯çœŸæ­£RecyclerViewçš„LayoutManagerå®ç° :joy:ï¼Œç›´æ¥å€Ÿè¿™ä¸ªä¾‹å­æ¥è¯´æ˜ç­–ç•¥æ¨¡å¼çš„å®ç°æ–¹å¼ï¼‰ã€‚å¯¹äºçº¿æ€§ï¼Œç½‘æ ¼ï¼Œç€‘å¸ƒæµä¸‰ç§å¸ƒå±€æ¥è¯´å…¶å®éƒ½æ˜¯ç­‰ä»·çš„ï¼Œåªä¸è¿‡å…·ä½“å¸ƒå±€ç®—æ³•é€»è¾‘ä¸é€šï¼Œåƒè¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥æŠ½è±¡å‡ºç­–ç•¥ã€‚

æŠ½è±¡å¸ƒå±€ç­–ç•¥ï¼Œå…¶ä¸­layoutå³ä¸ºå¸ƒå±€æ¥å£ï¼š

```java
/**
 * å¸ƒå±€ç­–ç•¥æŠ½è±¡
 */
public abstract class LayoutStragety {

  abstract void layout (ViewGroup parent, List<View> itemViews);

}
```

ä¸‰ç§å¸ƒå±€ç­–ç•¥çš„å®ç°ï¼š

```java
/**
 * çº¿æ€§å¸ƒå±€ç­–ç•¥å®ç°
 */
public class LinearLayoutStrategy extends LayoutStragety {

  @Override
  void layout (ViewGroup parent, List<View> itemViews) {
    // è®¡ç®—çºµå‘å¸ƒå±€
  }
}
```

```java
/**
 * ç½‘æ ¼å¸ƒå±€ç­–ç•¥å®ç°
 */
public class GridLayoutStrategy extends LayoutStragety {

  @Override
  void layout (ViewGroup parent, List<View> itemViews) {
    // è®¡ç®—ç½‘æ ¼å¼å¸ƒå±€
  }
}
```

```java
/**
 * ç€‘å¸ƒæµå¸ƒå±€ç­–ç•¥å®ç°
 */
public class StaggeredGridLayoutStrategy extends LayoutStragety {

  @Override
  void layout (ViewGroup parent, List<View> itemViews) {
    // è®¡ç®—ç€‘å¸ƒæµå¸ƒå±€æ ·å¼
  }
}
```

ç­–ç•¥çš„ä½¿ç”¨è€…`RecyclerView`ï¼ŒåŸå‹ä¸­çš„`Context`ï¼Œé€šè¿‡`setLayoutStrategy`æ¥è®¾ç½®å…·ä½“çš„å¸ƒå±€æ–¹å¼ï¼Œåœ¨`setData`ä¸­ä½¿ç”¨å…·ä½“çš„å¸ƒå±€æ„å»ºViewã€‚

```java
/**
 * ç­–ç•¥çš„ä½¿ç”¨æ–¹
 */
public class RecyclerView extends ViewGroup {

  private LayoutStragety layoutStragety;

  public void setLayoutStragety (LayoutStragety layoutStragety) {
    this.layoutStragety = layoutStragety;
  }

  public void setDatas (List<Object> datas) {
    List<View> itemViews = convertToViews(datas);
    if (layoutStragety == null) {
      throw new IllegalArgumentException("please set concrete layoutStragety");
    }
    layoutStragety.layout(this, itemViews);
  }

  private List<View> convertToViews (List<Object> datas) {
    // å°†æ•°æ®è½¬åŒ–æˆå¯æ˜¾ç¤ºçš„Viewå¯¹è±¡
    return null;
  }
}
```

ä¸Šå±‚`Client`ä½¿ç”¨ï¼š

```java
public class Client {

  public static void main (String[] args) {
    RecyclerView recyclerView = new RecyclerView();
    // åœ¨è¿™é‡Œéšæ„å¸ƒå±€ç­–ç•¥
    recyclerView.setLayoutStragety(new GridLayoutStrategy());
    recyclerView.setDatas(Collections.emptyList());
  }

}
```

## æ€»ç»“

ä¾‹å­å†™å®Œäº†ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„ä¼˜ç‚¹ï¼š

1. `Client`ä¸­ä¸å…³å¿ƒå¸ƒå±€çš„å…·ä½“å®ç°ï¼Œåªéœ€åˆ›å»ºå…·ä½“çš„å¸ƒå±€å®ç°å³å¯ï¼Œä½¿ç”¨ç®€å•ã€‚å½“ç„¶ä½ å¯èƒ½ä¼šè¯´æˆ‘åœ¨è¿™é‡Œå®šä¹‰å‡ ä¸ª`TYPE`å¸¸é‡ï¼Œç„¶åé€šè¿‡è®¾ç½®å¸¸é‡æ¥è®¾ç½®å¸ƒå±€ä¸€æ ·ç®€å•ğŸ˜‚ã€‚å½“ç„¶å¯ä»¥ï¼Œä½†æ˜¯æœ‰ä¸ªä¸å¥½çš„åœ°æ–¹æ˜¯ `RecyclerView`ä¸­å°±éœ€è¦å†™`if...else...`æ¥åˆ¤æ–­ä»¥åŠåˆå§‹åŒ–`LayoutStrategy`ï¼Œå¦‚æœç­–ç•¥å¤šäº†å°±ä¸ä¼˜é›…äº†ã€‚
2. `LayoutStrategy`å¾ˆå¥½æ‰©å±•ï¼Œå¦‚æœè¦æ·»åŠ ä¸€ç§æ–°çš„å¸ƒå±€ç­–ç•¥ï¼Œç›´æ¥æ–°å¢ä¸€ç§å®ç°å³å¯ï¼Œä¸éœ€è¦åŠ¨ä¹‹å‰çš„é€»è¾‘ã€‚

è¿™ä¸¤ç‚¹ä¹Ÿå°±æ˜¯ç­–ç•¥æ¨¡å¼çš„ä¼˜åŠ¿ï¼Œæ‰€ä»¥å¤§å®¶åœ¨é‡åˆ°å¯ä»¥æŠ½è±¡æˆç­–ç•¥çš„ç»“æ„æ—¶ï¼Œå¤šå¤šä½¿ç”¨å‘—ï¼Œè‚¯å®šèƒ½ç»™ä½ å¸¦æ¥æƒŠå–œã€‚

## æ€è€ƒ

å†™å®Œä¾‹å­ä¹‹åï¼Œçªç„¶ä¸€ä¸ªideaè·‘å‡ºæ¥ï¼Œå‡å¦‚æˆ‘ä»¬åœ¨è®¾è®¡ä¹‹åˆè¿™ä¸ª`ç­–ç•¥çš„æ¥å£`å®šä¹‰å¾—ä¸å¤Ÿå®Œç¾ï¼Œå½“éœ€è¦å®ç°æ–°ç­–ç•¥çš„æ—¶å€™è¿˜éœ€è¦å¤šä¸€ä¸ªå‚æ•°ï¼Œæ€ä¹ˆåŠï¼Ÿ
`abstract void layout (ViewGroup parent, List<View> itemViews, int diretion);`

å¦‚æœæ˜¯åœ¨è®¾è®¡ä¹‹åˆå°±èƒ½å‘ç°ï¼Œé‚£ä¹ˆå»ºè®®ä¿®æ”¹åŸå§‹ç­–ç•¥æ¥å£ï¼Œè®©å®ƒèƒ½æ›´é€šç”¨ï¼›å¦‚æœå·²ç»å‘å‡ºå»äº†ä¸èƒ½ä¿®æ”¹äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç®€å•æ‰©å±•ä¸€ä¸‹ï¼Œåšå…¼å®¹ï¼š

```java
/**
* ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå‚æ•°å˜åŒ–äº†
*/
public abstract class LayoutStrategyV2 extends LayoutStragety {

  @Override
  void layout (ViewGroup parent, List<View> itemViews) {

  }

  abstract void layout (ViewGroup parent, List<View> itemViews, int diretion);
}
```

```java
public class RecyclerView extends ViewGroup {

  //...

  public void setDatas (List<Object> datas, int direction) {
    List<View> itemViews = convertToViews(datas);
    if (layoutStragety == null) {
      throw new IllegalArgumentException("please set concrete layoutStragety");
    }
    // ä¿®æ”¹æ”¯æŒV2ç‰ˆæœ¬
    if (layoutStragety instanceof LayoutStrategyV2) {
      ((LayoutStrategyV2)layoutStragety).layout(this, itemViews, direction);
    }else{
      layoutStragety.layout(this, itemViews);
    }
  }

  // ...
}
```

ä½†æ˜¯ä½†æ˜¯ï¼Œæˆ‘åˆæƒ³äº†ä¸€ä¸‹ï¼Œå¦‚æœä½ ç­–ç•¥çš„è¾“å…¥éƒ½å˜äº†ï¼Œé‚£æ˜¯ä¸æ˜¯è¯´æ˜å·²ç»ä¸æ˜¯ä¸€ä¸ªç®—æ³•äº†ï¼Œé‚£ä¸€å®šè¿˜æœ‰å¿…è¦è®©å®ƒä»¬ä¸€å®šè¦æœ‰å…³ç³»å—ï¼Ÿè²Œä¼¼ä¸å¤ªéœ€æ±‚ï¼Œé‚£å°±æ²¡å¿…è¦åšå…¼å®¹ã€‚:joy:ä»è¿™ä¸ªé—®é¢˜å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸€å¼€å§‹ç­–ç•¥æ²¡æœ‰å®šä¹‰å¥½çš„è¯ï¼Œå¯èƒ½åé¢ä¼šå‡ºä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯å¼€å‘å°±æ˜¯è¿™æ ·å˜›ï¼Œä¸æ–­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡åº”è¯¥å°½é‡é¿å…ã€‚

å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®è¯·ç•™è¨€å‘ŠçŸ¥ï¼Œæ„Ÿè°¢! :pray:





